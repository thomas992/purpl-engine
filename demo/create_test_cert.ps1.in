$friendly_name = "Purpl engine MSIX certificate for @PURPL_APP_DISPLAY_NAME@"

Get-ChildItem Cert:\CurrentUser\My | Where-Object {$_.FriendlyName -eq $friendly_name} | Remove-Item

New-SelfSignedCertificate -Type Custom -Subject "CN=@PURPL_APP_ORGANIZATION_ID@, O=@PURPL_APP_ORGANIZATION@, L=@PURPL_APP_CITY@, S=@PURPL_APP_TERRITORY@, C=@PURPL_APP_COUNTRY@" -KeyUsage DigitalSignature -FriendlyName $friendly_name -CertStoreLocation "Cert:\CurrentUser\My" -TextExtension @("2.5.29.37={text}1.3.6.1.5.5.7.3.3", "2.5.29.19={text}")
$cert = Get-ChildItem Cert:\CurrentUser\My | Where-Object {$_.FriendlyName -eq $friendly_name}
$thumbprint = $cert.Thumbprint

$certificate_path = $PSScriptRoot + "\msix.pfx"

$password = Read-Host -Prompt "Enter the password for the certificate"

Export-PfxCertificate -cert "Cert:\CurrentUser\My\$thumbprint" -FilePath "$certificate_path" -Password (ConvertTo-SecureString $password -AsPlainText -Force)
echo "Created certificate at $certificate_path with the password $password"
echo "Keep this file safe, it will be used to sign the MSIX package and will be required to install the app"
echo "Once you've built the engine, you can sign the MSIX package with this command: signtool sign /fd sha256 /p $password /f $certificate_path <MSIX package location>"
echo "The MSIX package will be somewhere in $PSScriptRoot\AppPackages"

